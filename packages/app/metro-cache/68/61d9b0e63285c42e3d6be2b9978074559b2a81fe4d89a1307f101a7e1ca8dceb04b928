{"dependencies":[{"name":"BatchedBridge","data":{"isAsync":false}},{"name":"EventEmitter","data":{"isAsync":false}},{"name":"TaskQueue","data":{"isAsync":false}},{"name":"infoLog","data":{"isAsync":false}},{"name":"invariant","data":{"isAsync":false}},{"name":"fbjs/lib/keyMirror","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  'use strict';\n\n  var BatchedBridge = _$$_REQUIRE(_dependencyMap[0], \"BatchedBridge\");\n\n  var EventEmitter = _$$_REQUIRE(_dependencyMap[1], \"EventEmitter\");\n\n  var TaskQueue = _$$_REQUIRE(_dependencyMap[2], \"TaskQueue\");\n\n  var infoLog = _$$_REQUIRE(_dependencyMap[3], \"infoLog\");\n\n  var invariant = _$$_REQUIRE(_dependencyMap[4], \"invariant\");\n\n  var keyMirror = _$$_REQUIRE(_dependencyMap[5], \"fbjs/lib/keyMirror\");\n\n  var _emitter = new EventEmitter();\n\n  var DEBUG_DELAY = 0;\n  var DEBUG = false;\n  var InteractionManager = {\n    Events: keyMirror({\n      interactionStart: true,\n      interactionComplete: true\n    }),\n    runAfterInteractions: function runAfterInteractions(task) {\n      var tasks = [];\n      var promise = new Promise(function (resolve) {\n        _scheduleUpdate();\n\n        if (task) {\n          tasks.push(task);\n        }\n\n        tasks.push({\n          run: resolve,\n          name: 'resolve ' + (task && task.name || '?')\n        });\n\n        _taskQueue.enqueueTasks(tasks);\n      });\n      return {\n        then: promise.then.bind(promise),\n        done: function done() {\n          if (promise.done) {\n            return promise.done.apply(promise, arguments);\n          } else {\n            console.warn('Tried to call done when not supported by current Promise implementation.');\n          }\n        },\n        cancel: function cancel() {\n          _taskQueue.cancelTasks(tasks);\n        }\n      };\n    },\n    createInteractionHandle: function createInteractionHandle() {\n      DEBUG && infoLog('create interaction handle');\n\n      _scheduleUpdate();\n\n      var handle = ++_inc;\n\n      _addInteractionSet.add(handle);\n\n      return handle;\n    },\n    clearInteractionHandle: function clearInteractionHandle(handle) {\n      DEBUG && infoLog('clear interaction handle');\n      invariant(!!handle, 'Must provide a handle to clear.');\n\n      _scheduleUpdate();\n\n      _addInteractionSet.delete(handle);\n\n      _deleteInteractionSet.add(handle);\n    },\n    addListener: _emitter.addListener.bind(_emitter),\n    setDeadline: function setDeadline(deadline) {\n      _deadline = deadline;\n    }\n  };\n\n  var _interactionSet = new Set();\n\n  var _addInteractionSet = new Set();\n\n  var _deleteInteractionSet = new Set();\n\n  var _taskQueue = new TaskQueue({\n    onMoreTasks: _scheduleUpdate\n  });\n\n  var _nextUpdateHandle = 0;\n  var _inc = 0;\n\n  var _deadline = -1;\n\n  function _scheduleUpdate() {\n    if (!_nextUpdateHandle) {\n      if (_deadline > 0) {\n        _nextUpdateHandle = setTimeout(_processUpdate, 0 + DEBUG_DELAY);\n      } else {\n        _nextUpdateHandle = setImmediate(_processUpdate);\n      }\n    }\n  }\n\n  function _processUpdate() {\n    _nextUpdateHandle = 0;\n    var interactionCount = _interactionSet.size;\n\n    _addInteractionSet.forEach(function (handle) {\n      return _interactionSet.add(handle);\n    });\n\n    _deleteInteractionSet.forEach(function (handle) {\n      return _interactionSet.delete(handle);\n    });\n\n    var nextInteractionCount = _interactionSet.size;\n\n    if (interactionCount !== 0 && nextInteractionCount === 0) {\n      _emitter.emit(InteractionManager.Events.interactionComplete);\n    } else if (interactionCount === 0 && nextInteractionCount !== 0) {\n      _emitter.emit(InteractionManager.Events.interactionStart);\n    }\n\n    if (nextInteractionCount === 0) {\n      while (_taskQueue.hasTasksToProcess()) {\n        _taskQueue.processNext();\n\n        if (_deadline > 0 && BatchedBridge.getEventLoopRunningTime() >= _deadline) {\n          _scheduleUpdate();\n\n          break;\n        }\n      }\n    }\n\n    _addInteractionSet.clear();\n\n    _deleteInteractionSet.clear();\n  }\n\n  module.exports = InteractionManager;\n});","map":[[2,0,11,0],[4,0,13,0],[4,6,13,6,"BatchedBridge"],[4,19,13,19],[4,22,13,22,"require"],[4,33,13,29],[4,69,13,0],[6,0,14,0],[6,6,14,6,"EventEmitter"],[6,18,14,18],[6,21,14,21,"require"],[6,32,14,28],[6,67,14,0],[8,0,15,0],[8,6,15,6,"TaskQueue"],[8,15,15,15],[8,18,15,18,"require"],[8,29,15,25],[8,61,15,0],[10,0,17,0],[10,6,17,6,"infoLog"],[10,13,17,13],[10,16,17,16,"require"],[10,27,17,23],[10,57,17,0],[12,0,18,0],[12,6,18,6,"invariant"],[12,15,18,15],[12,18,18,18,"require"],[12,29,18,25],[12,61,18,0],[14,0,19,0],[14,6,19,6,"keyMirror"],[14,15,19,15],[14,18,19,18,"require"],[14,29,19,25],[14,70,19,0],[16,0,24,0],[16,6,24,6,"_emitter"],[16,14,24,14],[16,17,24,17],[16,21,24,21,"EventEmitter"],[16,33,24,17],[16,35,24,0],[18,0,26,0],[18,6,26,6,"DEBUG_DELAY"],[18,17,26,17],[18,20,26,20],[18,21,26,0],[19,0,27,0],[19,6,27,6,"DEBUG"],[19,11,27,11],[19,14,27,14],[19,19,27,0],[20,0,78,0],[20,6,78,6,"InteractionManager"],[20,24,78,24],[20,27,78,27],[21,0,79,2,"Events"],[21,4,79,2,"Events"],[21,10,79,8],[21,12,79,10,"keyMirror"],[21,21,79,19],[21,22,79,20],[22,0,80,4,"interactionStart"],[22,6,80,4,"interactionStart"],[22,22,80,20],[22,24,80,22],[22,28,79,20],[23,0,81,4,"interactionComplete"],[23,6,81,4,"interactionComplete"],[23,25,81,23],[23,27,81,25],[24,0,79,20],[24,5,79,19],[24,6,78,27],[25,0,88,2,"runAfterInteractions"],[25,4,88,2,"runAfterInteractions"],[25,24,78,27],[25,56,89,4,"task"],[25,60,78,27],[25,62,90,56],[26,0,91,4],[26,10,91,10,"tasks"],[26,15,91,15],[26,18,91,18],[26,20,91,4],[27,0,92,4],[27,10,92,10,"promise"],[27,17,92,17],[27,20,92,20],[27,24,92,24,"Promise"],[27,31,92,20],[27,32,92,32],[27,42,92,32,"resolve"],[27,49,92,39],[27,51,92,43],[28,0,93,6,"_scheduleUpdate"],[28,8,93,6,"_scheduleUpdate"],[28,23,93,21],[30,0,94,6],[30,12,94,10,"task"],[30,16,94,6],[30,18,94,16],[31,0,95,8,"tasks"],[31,10,95,8,"tasks"],[31,15,95,13],[31,16,95,14,"push"],[31,20,95,8],[31,21,95,19,"task"],[31,25,95,8],[32,0,96,7],[34,0,97,6,"tasks"],[34,8,97,6,"tasks"],[34,13,97,11],[34,14,97,12,"push"],[34,18,97,6],[34,19,97,17],[35,0,98,8,"run"],[35,10,98,8,"run"],[35,13,98,11],[35,15,98,13,"resolve"],[35,22,97,17],[36,0,99,8,"name"],[36,10,99,8,"name"],[36,14,99,12],[36,16,99,14],[36,30,99,29,"task"],[36,34,99,33],[36,38,99,37,"task"],[36,42,99,41],[36,43,99,42,"name"],[36,47,99,28],[36,51,99,51],[36,54,99,14],[37,0,97,17],[37,9,97,6],[39,0,101,6,"_taskQueue"],[39,8,101,6,"_taskQueue"],[39,18,101,16],[39,19,101,17,"enqueueTasks"],[39,31,101,6],[39,32,101,30,"tasks"],[39,37,101,6],[40,0,102,5],[40,7,92,20],[40,8,92,4],[41,0,103,4],[41,13,103,11],[42,0,104,6,"then"],[42,8,104,6,"then"],[42,12,104,10],[42,14,104,12,"promise"],[42,21,104,19],[42,22,104,20,"then"],[42,26,104,12],[42,27,104,25,"bind"],[42,31,104,12],[42,32,104,30,"promise"],[42,39,104,12],[42,40,103,11],[43,0,105,6,"done"],[43,8,105,6,"done"],[43,12,105,10],[43,14,105,12],[43,30,105,25],[44,0,106,8],[44,14,106,12,"promise"],[44,21,106,19],[44,22,106,20,"done"],[44,26,106,8],[44,28,106,26],[45,0,107,10],[45,19,107,17,"promise"],[45,26,107,24],[45,27,107,25,"done"],[45,31,107,17],[45,38,107,17,"promise"],[45,45,107,24],[45,57,107,10],[46,0,108,9],[46,11,106,8],[46,17,108,15],[47,0,109,10,"console"],[47,12,109,10,"console"],[47,19,109,17],[47,20,109,18,"warn"],[47,24,109,10],[47,25,110,12],[47,99,109,10],[48,0,112,9],[49,0,113,7],[49,9,103,11],[50,0,114,6,"cancel"],[50,8,114,6,"cancel"],[50,14,114,12],[50,16,114,14],[50,34,114,25],[51,0,115,8,"_taskQueue"],[51,10,115,8,"_taskQueue"],[51,20,115,18],[51,21,115,19,"cancelTasks"],[51,32,115,8],[51,33,115,31,"tasks"],[51,38,115,8],[52,0,116,7],[53,0,103,11],[53,7,103,4],[54,0,118,3],[54,5,78,27],[55,0,123,2,"createInteractionHandle"],[55,4,123,2,"createInteractionHandle"],[55,27,78,27],[55,64,123,36],[56,0,124,4,"DEBUG"],[56,6,124,4,"DEBUG"],[56,11,124,9],[56,15,124,13,"infoLog"],[56,22,124,20],[56,23,124,21],[56,50,124,20],[56,51,124,4],[58,0,125,4,"_scheduleUpdate"],[58,6,125,4,"_scheduleUpdate"],[58,21,125,19],[60,0,126,4],[60,10,126,10,"handle"],[60,16,126,16],[60,19,126,19],[60,21,126,21,"_inc"],[60,25,126,4],[62,0,127,4,"_addInteractionSet"],[62,6,127,4,"_addInteractionSet"],[62,24,127,22],[62,25,127,23,"add"],[62,28,127,4],[62,29,127,27,"handle"],[62,35,127,4],[64,0,128,4],[64,13,128,11,"handle"],[64,19,128,4],[65,0,129,3],[65,5,78,27],[66,0,134,2,"clearInteractionHandle"],[66,4,134,2,"clearInteractionHandle"],[66,26,78,27],[66,60,134,25,"handle"],[66,66,78,27],[66,68,134,41],[67,0,135,4,"DEBUG"],[67,6,135,4,"DEBUG"],[67,11,135,9],[67,15,135,13,"infoLog"],[67,22,135,20],[67,23,135,21],[67,49,135,20],[67,50,135,4],[68,0,136,4,"invariant"],[68,6,136,4,"invariant"],[68,15,136,13],[68,16,136,14],[68,17,136,15],[68,18,136,16,"handle"],[68,24,136,13],[68,26,136,24],[68,59,136,13],[68,60,136,4],[70,0,137,4,"_scheduleUpdate"],[70,6,137,4,"_scheduleUpdate"],[70,21,137,19],[72,0,138,4,"_addInteractionSet"],[72,6,138,4,"_addInteractionSet"],[72,24,138,22],[72,25,138,23,"delete"],[72,31,138,4],[72,32,138,30,"handle"],[72,38,138,4],[74,0,139,4,"_deleteInteractionSet"],[74,6,139,4,"_deleteInteractionSet"],[74,27,139,25],[74,28,139,26,"add"],[74,31,139,4],[74,32,139,30,"handle"],[74,38,139,4],[75,0,140,3],[75,5,78,27],[76,0,142,2,"addListener"],[76,4,142,2,"addListener"],[76,15,142,13],[76,17,142,15,"_emitter"],[76,25,142,23],[76,26,142,24,"addListener"],[76,37,142,15],[76,38,142,36,"bind"],[76,42,142,15],[76,43,142,41,"_emitter"],[76,51,142,15],[76,52,78,27],[77,0,149,2,"setDeadline"],[77,4,149,2,"setDeadline"],[77,15,78,27],[77,38,149,14,"deadline"],[77,46,78,27],[77,48,149,32],[78,0,150,4,"_deadline"],[78,6,150,4,"_deadline"],[78,15,150,13],[78,18,150,16,"deadline"],[78,26,150,4],[79,0,151,3],[80,0,78,27],[80,3,78,0],[82,0,154,0],[82,6,154,6,"_interactionSet"],[82,21,154,21],[82,24,154,24],[82,28,154,28,"Set"],[82,31,154,24],[82,33,154,0],[84,0,155,0],[84,6,155,6,"_addInteractionSet"],[84,24,155,24],[84,27,155,27],[84,31,155,31,"Set"],[84,34,155,27],[84,36,155,0],[86,0,156,0],[86,6,156,6,"_deleteInteractionSet"],[86,27,156,27],[86,30,156,30],[86,34,156,34,"Set"],[86,37,156,30],[86,39,156,0],[88,0,157,0],[88,6,157,6,"_taskQueue"],[88,16,157,16],[88,19,157,19],[88,23,157,23,"TaskQueue"],[88,32,157,19],[88,33,157,33],[89,0,157,34,"onMoreTasks"],[89,4,157,34,"onMoreTasks"],[89,15,157,45],[89,17,157,47,"_scheduleUpdate"],[90,0,157,33],[90,3,157,19],[90,4,157,0],[92,0,158,0],[92,6,158,4,"_nextUpdateHandle"],[92,23,158,21],[92,26,158,24],[92,27,158,0],[93,0,159,0],[93,6,159,4,"_inc"],[93,10,159,8],[93,13,159,11],[93,14,159,0],[95,0,160,0],[95,6,160,4,"_deadline"],[95,15,160,13],[95,18,160,16],[95,19,160,17],[95,20,160,0],[97,0,167,0],[97,11,167,9,"_scheduleUpdate"],[97,26,167,0],[97,29,167,27],[98,0,168,2],[98,8,168,6],[98,9,168,7,"_nextUpdateHandle"],[98,26,168,2],[98,28,168,26],[99,0,169,4],[99,10,169,8,"_deadline"],[99,19,169,17],[99,22,169,20],[99,23,169,4],[99,25,169,23],[100,0,173,6,"_nextUpdateHandle"],[100,8,173,6,"_nextUpdateHandle"],[100,25,173,23],[100,28,173,26,"setTimeout"],[100,38,173,36],[100,39,173,37,"_processUpdate"],[100,53,173,36],[100,55,173,53],[100,59,173,57,"DEBUG_DELAY"],[100,70,173,36],[100,71,173,6],[101,0,174,5],[101,7,169,4],[101,13,174,11],[102,0,175,6,"_nextUpdateHandle"],[102,8,175,6,"_nextUpdateHandle"],[102,25,175,23],[102,28,175,26,"setImmediate"],[102,40,175,38],[102,41,175,39,"_processUpdate"],[102,55,175,38],[102,56,175,6],[103,0,176,5],[104,0,177,3],[105,0,178,1],[107,0,183,0],[107,11,183,9,"_processUpdate"],[107,25,183,0],[107,28,183,26],[108,0,184,2,"_nextUpdateHandle"],[108,4,184,2,"_nextUpdateHandle"],[108,21,184,19],[108,24,184,22],[108,25,184,2],[109,0,186,2],[109,8,186,8,"interactionCount"],[109,24,186,24],[109,27,186,27,"_interactionSet"],[109,42,186,42],[109,43,186,43,"size"],[109,47,186,2],[111,0,187,2,"_addInteractionSet"],[111,4,187,2,"_addInteractionSet"],[111,22,187,20],[111,23,187,21,"forEach"],[111,30,187,2],[111,31,187,29],[111,41,187,29,"handle"],[111,47,187,35],[112,0,187,35],[112,13,187,39,"_interactionSet"],[112,28,187,54],[112,29,187,55,"add"],[112,32,187,39],[112,33,187,59,"handle"],[112,39,187,39],[112,40,187,35],[113,0,187,35],[113,5,187,2],[115,0,188,2,"_deleteInteractionSet"],[115,4,188,2,"_deleteInteractionSet"],[115,25,188,23],[115,26,188,24,"forEach"],[115,33,188,2],[115,34,188,32],[115,44,188,32,"handle"],[115,50,188,38],[116,0,188,38],[116,13,188,42,"_interactionSet"],[116,28,188,57],[116,29,188,58,"delete"],[116,35,188,42],[116,36,188,65,"handle"],[116,42,188,42],[116,43,188,38],[117,0,188,38],[117,5,188,2],[119,0,189,2],[119,8,189,8,"nextInteractionCount"],[119,28,189,28],[119,31,189,31,"_interactionSet"],[119,46,189,46],[119,47,189,47,"size"],[119,51,189,2],[121,0,191,2],[121,8,191,6,"interactionCount"],[121,24,191,22],[121,29,191,27],[121,30,191,6],[121,34,191,32,"nextInteractionCount"],[121,54,191,52],[121,59,191,57],[121,60,191,2],[121,62,191,60],[122,0,193,4,"_emitter"],[122,6,193,4,"_emitter"],[122,14,193,12],[122,15,193,13,"emit"],[122,19,193,4],[122,20,193,18,"InteractionManager"],[122,38,193,36],[122,39,193,37,"Events"],[122,45,193,18],[122,46,193,44,"interactionComplete"],[122,65,193,4],[123,0,194,3],[123,5,191,2],[123,11,194,9],[123,15,194,13,"interactionCount"],[123,31,194,29],[123,36,194,34],[123,37,194,13],[123,41,194,39,"nextInteractionCount"],[123,61,194,59],[123,66,194,64],[123,67,194,9],[123,69,194,67],[124,0,196,4,"_emitter"],[124,6,196,4,"_emitter"],[124,14,196,12],[124,15,196,13,"emit"],[124,19,196,4],[124,20,196,18,"InteractionManager"],[124,38,196,36],[124,39,196,37,"Events"],[124,45,196,18],[124,46,196,44,"interactionStart"],[124,62,196,4],[125,0,197,3],[127,0,200,2],[127,8,200,6,"nextInteractionCount"],[127,28,200,26],[127,33,200,31],[127,34,200,2],[127,36,200,34],[128,0,201,4],[128,13,201,11,"_taskQueue"],[128,23,201,21],[128,24,201,22,"hasTasksToProcess"],[128,41,201,11],[128,43,201,4],[128,45,201,43],[129,0,202,6,"_taskQueue"],[129,8,202,6,"_taskQueue"],[129,18,202,16],[129,19,202,17,"processNext"],[129,30,202,6],[131,0,203,6],[131,12,204,8,"_deadline"],[131,21,204,17],[131,24,204,20],[131,25,204,8],[131,29,205,8,"BatchedBridge"],[131,42,205,21],[131,43,205,22,"getEventLoopRunningTime"],[131,66,205,8],[131,72,205,51,"_deadline"],[131,81,203,6],[131,83,206,8],[132,0,208,8,"_scheduleUpdate"],[132,10,208,8,"_scheduleUpdate"],[132,25,208,23],[134,0,209,8],[135,0,210,7],[136,0,211,5],[137,0,212,3],[139,0,213,2,"_addInteractionSet"],[139,4,213,2,"_addInteractionSet"],[139,22,213,20],[139,23,213,21,"clear"],[139,28,213,2],[141,0,214,2,"_deleteInteractionSet"],[141,4,214,2,"_deleteInteractionSet"],[141,25,214,23],[141,26,214,24,"clear"],[141,31,214,2],[142,0,215,1],[144,0,217,0,"module"],[144,2,217,0,"module"],[144,8,217,6],[144,9,217,7,"exports"],[144,16,217,0],[144,19,217,17,"InteractionManager"],[144,37,217,0]]},"type":"js/module"}]}